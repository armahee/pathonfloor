<!DOCTYPE html>
<html>
<head>
	<title>AR Mahee Project</title>
	<style type="text/css">
		body {
			background-color: #000;
			margin: 0px;
		}
		#header {
			position: absolute;
			width: 400px;
			background-color: white;
			padding: 20px;
		}
		#bdy {
			left: 500px;
			position: absolute;
			width: 62%
		}
		.door {
			position: absolute;
			border-radius: 5px;
			background: red;
		}
		.vpath {
			width: 0px;
			height: 5px;
		}
		.hpath {
			width: 5px;
			height: 0px;
		}
		#f0rm7 {
			top: 445px;
			left: 245px;
		}
		#f0rm10 {
			top: 445px;
			left: 265px;
		}
		#f0rm18 {
			top: 445px;
			left: 391px;
		}
		#f0rm20 {
			top: 410px;
			left: 391px;
		}
		#f0rm21 {
			top: 395px;
			left: 391px;
		}

	</style>
</head>
<body>
<div id='header'>
	<label for="flr">Choose a floor:</label>
	<select id='flr' onchange="changeFloor()">
		<option selected="" value="">Select a floor</option>
		<option value="0">Ground Floor</option>
		<option value="1">Lower First Floor</option>
		<option value="2">First Floor</option>
		<option value="3">Second Floor</option>
	</select><br><br>
</div>
<div id='bdy'>
	<img id="imgLoader" src="">
</div>
<script type="text/javascript">
	//document.getElementById("srm").addEventListener("change",startRoom,false);

	/* Function to return the DOM object's in crossbrowser style */
	function heightCrossBrowser(element) {
	    /* element - DOM element */

	    /* For FireFox & IE */
	    if(     element.height != undefined && element.height != '' && element.height != 0){
	        this.height  =   element.height;
	    }
	    /* For FireFox & IE */
	    else if(element.clientHeight != undefined && element.clientHeight != '' && element.clientHeight != 0){
	        this.height  =   element.clientHeight;
	    }
	    /* For Chrome * FireFox */
	    else if(element.naturalHeight != undefined && element.naturalHeight != '' && element.naturalHeight != 0){
	        this.height  =   element.naturalHeight;
	    }
	    /* For FireFox & IE */
	    else if(element.offsetHeight != undefined && element.offsetHeight != '' && element.offsetHeight != 0){
	        this.height  =   element.offsetHeight;
	    }       
	        /*
	            console.info(' widthWidth height:',      element.height);
	            console.info(' clntWidth clientHeight:', element.clientHeight);
	            console.info(' natWidth naturalHeight:', element.naturalHeight);
	            console.info(' offstWidth offsetHeight:',element.offsetHeight);       
	            console.info(' parseInt(this.height):',parseInt(this.height));
	        */
	    return parseInt(this.height);

	}
	function sleep(ms) {
	  return new Promise(resolve => setTimeout(resolve, ms));
	}
	console.log('working');
	var straitLine_i = 0, drawIsRunning, imgScale = 600, pathScale = 1, floorNum, arrayFl, arrayGr;//, shortpath = 999999;
	async function drawSLine(fromX, fromY, toX, toY) {
		fromX = fromX / pathScale;
		fromY = fromY / pathScale;
		toX = toX / pathScale;
		toY = toY / pathScale;
		var info = document.createElement('div');
		info.style.position = 'absolute';
		info.style.borderRadius = '5px';
		info.style.left = fromX+'px';
		info.style.top = fromY+'px';
		info.style.backgroundColor = 'red';
		info.style.zIndex = '1';
		info.id = 'straitLine'+straitLine_i;
		document.getElementById('bdy').appendChild(info);
		if(fromX == toX){
			if(toY > fromY){
				info.style.width = '5px';
				info.style.height = '0px';
				for (var i = 1; i <= toY - (fromY - 1); i++) {
					info.style.height = i.toString()+"px";
					await sleep(5);
				}
			}
			else if(toY < fromY){
				info.style.width = '5px';
				info.style.height = '0px';
				for (var i = 1; i <= fromY - toY; i++) {
					info.style.top = (parseInt(info.style.top, 10) - 1)+'px';
					info.style.height = i.toString()+'px';
					await sleep(5);
				}
			}
			else{
				info.style.width = '5px';
				info.style.height = '5px';
			}
		}
		else if(fromY == toY){
			if(toX > fromX){
				info.style.width = '0px';
				info.style.height = '5px';
				for (var i = 1; i <= toX - (fromX - 1); i++) {
					info.style.width = i.toString()+'px';
					await sleep(5);
				}
			}
			else if(toX < fromX){
				info.style.width = '0px';
				info.style.height = '5px';
				for (var i = 1; i <= fromX - (toX - 1); i++) {
					info.style.left = (parseInt(info.style.left, 10) - 1)+'px';
					info.style.width = i.toString()+'px';
					await sleep(5);
				}
			}
			else{
				info.style.width = '5px';
				info.style.height = '5px';
			}
		}
		else{
			console.log(fromX+','+fromY+' | '+toX+','+toY);
			alert('Sorry! Unable to draw Strait Line');
		}
		//animate(info.id, toX, toY);
	}

	function removeLines() {
		var linepar = document.getElementById('bdy');
		while(straitLine_i){
			straitLine_i--;
			linepar.removeChild(document.getElementById('straitLine'+straitLine_i));
		}
	}

	function pathDist(srmv, ermv) {
		if(points[floorNum][srmv][0] == points[floorNum][ermv][0]){
			return Math.abs(points[floorNum][srmv][1]-points[floorNum][ermv][1]);
		}
		else if(points[floorNum][srmv][1] == points[floorNum][ermv][1]){
			return Math.abs(points[floorNum][srmv][0]-points[floorNum][ermv][0]);
		}
		else{
			alert('There is a problem with graph. Nodes are not connected!');
			return -1;
		}
	}
	/*drawSLine(160, 10, 590, 10);
	straitLine_i ++;
	drawSLine(590, 10, 590, 485);
	straitLine_i ++;
	drawSLine(595, 485, 165, 485);
	straitLine_i ++;
	drawSLine(160, 490, 160, 10);
	straitLine_i ++;
	setTimeout(removeLines, 3000);*/
	var img = [
		'groundFloor.jpg',
		'lowerFloor.jpg',
		'firstFloor.jpg',
		'secondFloor.jpg'
	];
	var menu = [
		[
			[0,'Loading Bay'],
			[38,'Main Entrance'],
			[4,'LIFT'],
			[68,'Disabled Lift'],
			[5,'Stairs(Besides Loading Bay)'],
			[39,'Stairs(Besides Main Entrance)'],
			[31,'Male Toilet(Besides G105 IT Services)'],
			[64,'Male Toilet(Besides G23 Computr Cluster)'],
			[24,'Female Toilet'],
			[28,'Disabled Toilet'],
			[8,'IT Services Right(Besides Loading Bay)'],
			[9,'IT Services Left(Besides Loading Bay)'],
			[36,'IT Services(Besides Main Entrance)'],
			[12,'G105 IT Services'],
			[32,'IT Services Helpdesk'],
			[41,'G6'],
			[43,'G7'],
			[45,'G10'],
			[47,'G11'],
			[49,'G12'],
			[51,'G13'],
			[54,'G14'],
			[55,'G16'],
			[56,'G18'],
			[58,'G20'],
			[60,'G21'],
			[66,'G23 Computer Cluster'],
			[18,'G33 Research Lab'],
			[62,'G33a'],
			[20,'G35'],
			[69,'G36'],
			[22,'G37'],
			[15,'G41 Collaborative Space']
		],
		[
			[0,'LIFT'],
			//[5,'Disabled Stairs'],
			[8,'Stairs(Besides Disabled Stairs)'],
			[10,'LF29'],
			[12,'LF28'],
			[14,'LF27'],
			[17,'LF26'],
			[19,'LF25'],
			[21,'LF24'],
			[23,'LF23'],
			[25,'Stairs(Besides Student Support Office)'],
			[28,'LF22'],
			[30,'Student Support Office'],
			[32,'LF21 Student Resource Centre'],
			[35,'LF17 PGR Space'],
			[37,'LF15 PGR Lab'],
			[41,'LF31 Computer Cluster'],
			[45,'LF34 Collab 2'],
			[49,'Vending'],
			[46,'LF39 Collab 1'],
			[52,'LF16 Tootill 1 Computer Cluster'],
			[55,'LF9 Tootill 0 Computer Cluster'],
			[75,'LF10'],
			[76,'LF11'],
			[78,'Stairs(Besides Lecture Theatre 1.1)'],
			[79,'Lecture Theatre 1.1'],
			[60,'Water Vending'],
			[68,'Byte Cafe'],
			[72,'Stairs(Besides Byte Cafe)'],
			[82,'LF6'],
			[84,'LF5'],
			[87,'Disabled LIFT(Besides LF7 Research Lab)'],
			[88,'Stairs(Besides LF7 Research Lab)'],
			[89,'LF8 Quiet Lab'],
			[103,'LF7 Research Lab'],
			[101,'Male Toilet'],
			[98,'Female Toilet'],
			[95,'Disabled Lift(Besides LF1 Research Lab)'],
			[90,'LF1 Research Lab'],
			[93,'Stairs(Besides LF1 Research Lab)']
		],
		[],
		[]
	];

	var points = [
		[
			[1080,285],//0
			[1080,500],//1
			[1150,500],//2
			[1150,460],//3
			[1150,400],//4
			[1260,460],//5
			[1325,500],//6
			[1325,870],//7
			[1395,870],//8
			[1270,870],//9
			[1325,1300],//10
			[1500,1300],//11
			[1500,1220],//12
			[1620,1300],//13
			[1620,1000],//14
			[1850,1000],//15
			[1850,1165],//16
			[2150,1165],//17
			[2150,1300],//18
			[1795,1300],//19
			[1795,1360],//20
			[1715,1300],//21
			[1715,1360],//22
			[1620,1400],//23
			[1565,1400],//24
			[1620,1530],//25
			[1385,1530],//26
			[1385,1450],//27
			[1435,1450],//28
			[1325,1450],//29
			[1325,1335],//30
			[1460,1335],//31
			[1325,1530],//32
			[1325,1810],//33
			[1385,1810],//34
			[1385,1865],//35
			[1300,1865],//36
			[1450,1865],//37
			[1450,2030],//38
			[1450,1820],//39
			[1535,1865],//40
			[1535,1930],//41
			[1610,1865],//42
			[1610,1930],//43
			[1675,1865],//44
			[1675,1930],//45
			[1750,1865],//46
			[1750,1930],//47
			[1905,1865],//48
			[1905,1930],//49
			[1955,1865],//50
			[1955,1930],//51
			[2150,1865],//52
			[2150,1905],//53
			[2070,1905],//54
			[2220,1905],//55
			[2220,1865],//56
			[2150,1725],//57
			[2220,1725],//58
			[2150,1680],//59
			[2220,1680],//60
			[2150,1435],//61
			[2090,1435],//62
			[2105,1725],//63
			[2105,1670],//64
			[1840,1725],//65
			[1840,1530],//66
			[1565,1530],//67
			[1565,1800],//68
			[1715,1230]//69
		],
		[
			[1040,410],//0
			[1040,470],//1
			[1210,470],//2
			[1210,290],//3
			[1165,290],//4
			[1165,355],//5
			[1250,290],//6
			[1250,230],//7
			[1165,230],//8
			[1380,290],//9
			[1380,230],//10
			[1510,290],//11
			[1510,230],//12
			[1645,290],//13
			[1645,230],//14
			[1715,290],//15
			[1770,290],//16
			[1770,230],//17
			[1900,290],//18
			[1900,230],//19
			[2030,290],//20
			[2030,230],//21
			[2080,290],//22
			[2170,290],//23
			[2080,365],//24
			[2160,365],//25
			[2080,425],//26
			[1985,425],//27
			[1985,350],//28
			[1985,480],//29
			[2050,480],//30
			[1940,480],//31
			[1940,590],//32
			[1775,590],//33
			[1775,660],//34
			[1775,750],//35
			[1990,660],//36
			[1990,750],//37
			[1715,660],//38
			[1665,660],//39
			[1665,550],//40
			[1515,550],//41
			[1515,750],//42
			[1715,750],//43
			[1715,880],//44
			[1440,880],//45
			[1440,1140],//46
			[1715,1140],//47
			[1715,980],//48
			[1595,980],//49
			[1715,940],//50
			[1880,940],//51
			[1880,1190],//52
			[2085,1190],//53
			[2085,1295],//54
			[2000,1295],//55
			[1715,1295],//56
			[1715,1330],//57
			[1630,1330],//58
			[1630,1420],//59
			[1630,1460],//60
			[1590,1420],//61
			[1590,1475],//62
			[1530,1475],//63
			[1345,1475],//64
			[1345,1140],//65
			[1345,1545],//66
			[1530,1545],//67
			[1630,1545],//68
			[1630,1585],//69
			[1715,1585],//70
			[1715,1640],//71
			[1650,1640],//72
			[2000,1640],//73
			[2000,1475],//74
			[2080,1475],//75
			[2080,1565],//76
			[2065,1640],//77
			[2165,1640],//78
			[2065,1710],//79
			[1715,1735],//80
			[1665,1735],//81
			[1665,1800],//82
			[1580,1735],//83
			[1580,1800],//84
			[1485,1735],//85
			[1485,1785],//86
			[1485,1825],//87
			[1355,1785],//88
			[1715,2040],//89
			[980,2040],//90
			[980,1735],//91
			[860,1735],//92
			[860,1665],//93
			[1060,1735],//94
			[1060,1705],//95
			[1100,1735],//96
			[1100,1805],//97
			[1200,1805],//98
			[1190,1735],//99
			[1190,1775],//100
			[1290,1775],//101
			[1345,1735],//102
			[1430,2040]//103
		],
		[],
		[]
	];

	var graph = [
		[
			[1],//0
			[0,2],//1
			[1,3,6],//2
			[4,5,2],//3
			[3],//4
			[3],//5
			[2,7],//6
			[6,8,9,10],//7
			[7],//8
			[7],//9
			[7,11,30],//10
			[10,12,13],//11
			[11],//12
			[11,14,21,23],//13
			[13,15],//14
			[14,16],//15
			[15,17],//16
			[16,18],//17
			[17,19,61],//18
			[18,20,21],//19
			[19],//20
			[69,22,13,19],//21
			[21],//22
			[24,13,25],//23
			[23],//24
			[23,66,67],//25
			[67,27,34],//26
			[28,29,26],//27
			[27],//28
			[27,30,32],//29
			[31,10,29],//30
			[30],//31
			[29,33],//32
			[32,34],//33
			[26,35,33],//34
			[36,37,34],//35
			[35],//36
			[38,39,35,40],//37
			[37],//38
			[37],//39
			[41,37,42],//40
			[40],//41
			[43,40,44],//42
			[42],//43
			[45,42,46],//44
			[44],//45
			[47,44,48],//46
			[46],//47
			[49,46,50],//48
			[48],//49
			[51,48,52],//50
			[50],//51
			[56,53,50,57],//52
			[54,55,52],//53
			[53],//54
			[53],//55
			[52],//56
			[58,52,59,63],//57
			[57],//58
			[60,57,61],//59
			[59],//60
			[62,18,59],//61
			[61],//62
			[64,57,65],//63
			[63],//64
			[63,66],//65
			[25,65],//66
			[68,25,26],//67
			[67],//68
			[21]//69
		],
		[
			[1],//0
			[0,2],//1
			[1,3],//2
			[2,4,6],//3
			[3,5],//4
			[4],//5
			[3,9,7],//6
			[6,8],//7
			[7],//8
			[6,10,11],//9
			[9],//10
			[9,12,13],//11
			[11],//12
			[11,14,15],//13
			[13],//14
			[13,16,38],//15
			[15,17,18],//16
			[16],//17
			[16,19,20],//18
			[18],//19
			[18,21,22],//20
			[20],//21
			[20,23,24],//22
			[22],//23
			[22,25,26],//24
			[24],//25
			[24,27],//26
			[28,26,29],//27
			[27],//28
			[30,31,27],//29
			[29],//30
			[29,32],//31
			[31,33],//32
			[32,34],//33
			[33,38,35,36],//34
			[34],//35
			[34,37],//36
			[36],//37
			[39,34,43,15],//38
			[40,38],//39
			[39,41],//40
			[40,42],//41
			[43,41],//42
			[38,42,44],//43
			[50,43,45],//44
			[44,46],//45
			[65,45,47],//46
			[46,48,56],//47
			[50,49,47],//48
			[48],//49
			[44,51,48],//50
			[50,52],//51
			[53,51],//52
			[52,54],//53
			[53,55],//54
			[54,56,74],//55
			[47,55,57],//56
			[56,58,70],//57
			[57,59,],//58
			[58,61,60],//59
			[59],//60
			[62,59],//61
			[63,61],//62
			[64,62,67],//63
			[65,66,63],//64
			[46,64],//65
			[64,102,67],//66
			[63,66,68],//67
			[67,69],//68
			[70,68],//69
			[57,71,69],//70
			[70,72,73,80],//71
			[71],//72
			[74,71,77],//73
			[55,75,73],//74
			[74,76],//75
			[75],//76
			[73,78,79],//77
			[77],//78
			[77],//79
			[71,81,89],//80
			[83,80,82],//81
			[81],//82
			[85,81,84],//83
			[83],//84
			[102,83,86],//85
			[88,85,87],//86
			[86],//87
			[86],//88
			[80,103],//89
			[91,103],//90
			[92,94,90],//91
			[93,91],//92
			[92],//93
			[95,91,96],//94
			[94],//95
			[94,99,97],//96
			[96,98],//97
			[97],//98
			[96,102,100],//99
			[99,101],//100
			[100],//101
			[66,99,85],//102
			[90,89]//103
		],
		[],
		[]
	];

	function changeFloor() {
		removeLines();
		if(document.getElementById('srm')){
			document.getElementById('header').removeChild(document.getElementById('srml'));
			document.getElementById('header').removeChild(document.getElementById('srm'));
			document.getElementById('header').removeChild(document.getElementsByTagName('br')[0]);
			document.getElementById('header').removeChild(document.getElementsByTagName('br')[0]);
		}
		if(document.getElementById('erm')){
			document.getElementById('header').removeChild(document.getElementById('erml'));
			document.getElementById('header').removeChild(document.getElementById('erm'));
		}
		var iml = document.getElementById('imgLoader');
		iml.src = '';
		if(document.getElementById('flr').value != ''){
			floorNum = parseInt(document.getElementById('flr').value);
			document.getElementById('bdy').removeChild(iml);
			iml = document.createElement('img');
			iml.id = 'imgLoader';
			iml.src = img[floorNum];
			document.getElementById('bdy').appendChild(iml);
			iml.onload = function () {
				var elementHeight = heightCrossBrowser(iml);
				pathScale = elementHeight / imgScale;// imgScale = 600
				iml.style.height = imgScale+'px';
				console.log('Current Image Height:'+elementHeight);
			}
			console.log('Current Path Scale:'+pathScale);
			var array0 = new Array(graph[floorNum].length);
			array0.fill(true);
			drawIsRunning = new Array(graph[floorNum].length);
			drawIsRunning.fill(array0);

			var srml = document.createElement('label');
			srml.innerHTML = 'Select Start Position: ';
			srml.for = 'srm';
			srml.id = 'srml';
			document.getElementById('header').appendChild(srml);
			var srm = document.createElement('select');
			srm.id = 'srm';
			srm.addEventListener('change', showPath);
			var foptn = document.createElement('option');
			foptn.value = '';
			foptn.innerHTML = 'Select Start Position';
			srm.appendChild(foptn);
			document.getElementById('header').appendChild(srm);
			document.getElementById('header').appendChild(document.createElement('br'));
			document.getElementById('header').appendChild(document.createElement('br'));
			var erml = document.createElement('label');
			erml.innerHTML = 'Select Ending Position: ';
			erml.for = 'erm';
			erml.id = 'erml';
			document.getElementById('header').appendChild(erml);
			var erm = document.createElement('select');
			erm.id = 'erm';
			erm.addEventListener('change', showPath);
			foptn = document.createElement('option');
			foptn.value = '';
			foptn.innerHTML = 'Select Ending Position';
			erm.appendChild(foptn);
			document.getElementById('header').appendChild(erm);
			for (var i = 0, len = menu[floorNum].length; i < len; i++) {
				var optn = document.createElement('option');
				optn.innerHTML = menu[floorNum][i][1];
				optn.value = menu[floorNum][i][0];
				srm.appendChild(optn);
				optn = document.createElement('option');
				optn.innerHTML = menu[floorNum][i][1];
				optn.value = menu[floorNum][i][0];
				erm.appendChild(optn);
			}
		}
		else{
			floorNum = '';
		}
	}

	function dijkstra(srmv, ermv) {
		var path = new Array(graph[floorNum].length),
			vist = new Array(graph[floorNum].length),
			nods = new Array(graph[floorNum].length);

		path.fill(-1);
		vist.fill(false);
		nods.fill(0);
		path[srmv] = -2;
		var fl = true;
		var nodeSteps = 0;
		while(fl){
			nodeSteps ++;
			fl = false;
			for (var i = 0; i < path.length; i++) {
				if(path[i] != -1 && !vist[i] && nods[i] < nodeSteps){
					vist[i] = true;
					for (var j = 0; j < graph[floorNum][i].length; j++) {
						//console.log(i+':'+graph[floorNum][i][j]+':'+path[graph[floorNum][i][j]]);
						if(path[graph[floorNum][i][j]] == -1){
							path[graph[floorNum][i][j]] = i;
							nods[graph[floorNum][i][j]] = nodeSteps;
						}
					}
				}
				if(!vist[i]){
					fl = true;
				}
			}
		}
		var res = new Array(), resi = ermv;
		while(path[resi] != -2){
			res.unshift(resi);
			resi = path[resi];
		}
		return res;
	}

	async function showPath() {
		removeLines();
		if(document.getElementById('srm').value != '' && document.getElementById('erm').value != ''){
			var srmv = parseInt(document.getElementById('srm').value),
				ermv = parseInt(document.getElementById('erm').value);
			//console.log(dijkstra(srmv,ermv));
			drawSLine(points[floorNum][srmv][0],points[floorNum][srmv][1],
				points[floorNum][srmv][0],points[floorNum][srmv][1]+5);
			straitLine_i ++;
			drawSLine(points[floorNum][ermv][0],points[floorNum][ermv][1],
				points[floorNum][ermv][0],points[floorNum][ermv][1]+5);
			straitLine_i ++;
			var res = dijkstra(srmv,ermv);
			if(res == []){
				console.log('failed');
			}
			else{
				console.log('successfull');
				res.unshift(srmv);
				console.log(res);
				//res[2] = shortify(res[2]);
				//console.log(res[2]);
				//console.log('----------------------'+arrayGr[29]);
				var array0 = new Array(graph[floorNum].length);
				array0.fill(true);
				drawIsRunning = new Array(graph[floorNum].length);
				drawIsRunning.fill(array0);
				drawIsRunning[srmv][ermv] = false;
				removeLines();
				for (var i = 1, len = res.length; i < len; i++) {
					if(drawIsRunning[srmv][ermv]){
						break;
					}
					drawSLine(
						points[floorNum][res[i-1]][0], points[floorNum][res[i-1]][1],
						points[floorNum][res[i]][0], points[floorNum][res[i]][1]
						);
					straitLine_i ++;
					await sleep(pathDist(res[i], res[i-1])*2);
				}
			}
		}
		else{
			var array0 = new Array(graph[floorNum].length);
			array0.fill(true);
			drawIsRunning = new Array(graph[floorNum].length);
			drawIsRunning.fill(array0);
			removeLines();
		}
	}
	/*
	// mouse down handler
	function onMouseDown(evt) {
	  var mousex = event.clientX;//(event.clientX / window.innerWidth) * 2 - 1;
	  var mousey = event.clientY;//-(event.clientY / window.innerHeight) * 2 + 1;
	  //alert("X: "+mousex+"; Y: "+mousey);
	  //console.log("Mouse Clicked:: X: "+mousex+"; Y: "+mousey);
	  document.getElementById('display').innerHTML = "Mouse Clicked:: X: "+mousex+"; Y: "+mousey;
	}*/

</script>

</body>
</html>
